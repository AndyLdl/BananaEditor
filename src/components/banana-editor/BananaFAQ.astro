---
/**
 * BananaEditor FAQ组件
 * 展示关于nano banana AI的常见问题
 * 美化版本：现代化卡片设计 + 增强动画效果
 */

import { Icon } from "astro-icon/components";
import { loadTranslations, createTranslator } from "../../i18n/utils";

// 获取当前语言
import { detectLanguageFromRequest } from "../../utils/language-detector";
const currentLang = detectLanguageFromRequest(Astro.request);

// 加载翻译
const homeTranslations = await loadTranslations(currentLang, "home");
const t = createTranslator(currentLang, homeTranslations);
---

<section class="py-20 sm:py-32 bg-gradient-to-br from-white via-gray-50 to-banana-light/20 relative overflow-hidden">
  <!-- 背景装饰 -->
  <div class="absolute inset-0 bg-[url('/images/grid-pattern.svg')] opacity-5 pointer-events-none"></div>
  <div class="absolute top-0 left-1/4 w-96 h-96 bg-banana-primary/5 rounded-full blur-3xl"></div>
  <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-banana-secondary/5 rounded-full blur-3xl"></div>
  
  <div class="mx-auto max-w-4xl px-6 lg:px-8 relative z-10">
    <!-- 标题区域 -->
    <div class="text-center mb-20">
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-full text-banana-primary font-medium text-sm mb-6 shadow-lg border border-banana-primary/10">
        <Icon name="heroicons:question-mark-circle" class="w-4 h-4 text-orange-500" />
        <span>FAQ</span>
      </div>

      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight text-gray-900 mb-6">
        {t("faq.title")}
      </h2>
      <p class="text-lg sm:text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
        {t("faq.subtitle")}
      </p>
    </div>

    <!-- FAQ列表 -->
    <div class="space-y-3">
      {
        (t("faq.items") || []).map((item: any, index: number) => (
          <div class="faq-item group relative" data-index={index}>
            <button
              class="faq-question w-full text-left bg-white/90 backdrop-blur-sm rounded-2xl px-6 py-5 lg:px-8 lg:py-6 border border-gray-200/60 hover:border-banana-primary/40 transition-all duration-300 hover:shadow-lg hover:shadow-banana-primary/5 group-hover:bg-white relative overflow-hidden"
              aria-expanded="false">
              
              <!-- 左侧装饰条 -->
              <div class="absolute left-0 top-0 bottom-0 w-1 bg-banana-gradient opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              
              <div class="relative flex items-center justify-between gap-4">
                <h3 class="text-base lg:text-lg font-semibold text-gray-900 group-hover:text-gray-950 transition-colors flex-1 pr-4 leading-snug">
                  {item.question}
                </h3>
                
                <!-- 展开图标 - 更简洁的设计 -->
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 rounded-lg bg-gray-100 group-hover:bg-banana-primary/10 flex items-center justify-center transition-all duration-300 group-hover:scale-110">
                    <Icon
                      name="heroicons:plus"
                      class="w-4 h-4 text-gray-600 group-hover:text-banana-primary transition-all duration-300 faq-icon faq-icon-plus"
                    />
                    <Icon
                      name="heroicons:minus"
                      class="w-4 h-4 text-gray-600 group-hover:text-banana-primary transition-all duration-300 faq-icon faq-icon-minus hidden"
                    />
                  </div>
                </div>
              </div>
            </button>

            <!-- 答案区域 -->
            <div
              class="faq-answer overflow-hidden transition-all duration-500 ease-in-out"
              style="max-height: 0;">
              <div class="px-6 py-5 lg:px-8 lg:py-6 bg-gradient-to-br from-gray-50/50 via-white to-banana-light/10 border-x border-b border-gray-200/60 rounded-b-2xl ml-0 relative">
                
                <!-- 左侧装饰条 -->
                <div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-banana-primary to-banana-secondary"></div>
                
                <div class="relative pl-6">
                  <p class="text-gray-700 leading-relaxed text-sm lg:text-base">
                    {item.answer}
                  </p>
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>

    <!-- 底部帮助 -->
    <div class="text-center mt-16 pt-12 border-t border-gray-200/50">
      <div class="inline-flex flex-col items-center gap-6 px-8 py-6 bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-lg">
        <div class="w-16 h-16 bg-banana-gradient rounded-2xl flex items-center justify-center shadow-xl">
          <Icon name="heroicons:chat-bubble-left-right" class="w-8 h-8 text-white" />
        </div>
        <div>
          <p class="text-gray-900 font-semibold text-lg mb-2">
            Still have questions about nano banana AI?
          </p>
          <p class="text-gray-600 text-sm mb-4">
            Our support team is here to help you
          </p>
        </div>
        <a
          href="/contact"
          class="group/cta inline-flex items-center gap-2 px-6 py-3 bg-banana-gradient text-white font-semibold rounded-xl hover:shadow-xl transition-all duration-300 hover:scale-105">
          <Icon name="heroicons:envelope" class="w-5 h-5 group-hover/cta:animate-bounce" />
          <span>Contact Support</span>
          <Icon name="heroicons:arrow-right" class="w-5 h-5 group-hover/cta:translate-x-1 transition-transform" />
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  // FAQ折叠/展开功能
  document.addEventListener("DOMContentLoaded", () => {
    const faqItems = document.querySelectorAll(".faq-item");

    faqItems.forEach((item) => {
      const question = item.querySelector(".faq-question");
      const answer = item.querySelector(".faq-answer") as HTMLElement;

      if (!question || !answer) return;

      question.addEventListener("click", () => {
        const isExpanded = question.getAttribute("aria-expanded") === "true";

        // 关闭所有其他FAQ
        faqItems.forEach((otherItem) => {
          if (otherItem !== item) {
            const otherQuestion = otherItem.querySelector(".faq-question");
            const otherAnswer = otherItem.querySelector(
              ".faq-answer"
            ) as HTMLElement;

            if (otherQuestion && otherAnswer) {
              otherQuestion.setAttribute("aria-expanded", "false");
              otherAnswer.style.maxHeight = "0";
              const otherPlus = otherQuestion.querySelector(".faq-icon-plus");
              const otherMinus = otherQuestion.querySelector(".faq-icon-minus");
              if (otherPlus) otherPlus.classList.remove("hidden");
              if (otherMinus) otherMinus.classList.add("hidden");
              otherItem.classList.remove("faq-expanded");
            }
          }
        });

        // 切换当前FAQ
        const plusIcon = question.querySelector(".faq-icon-plus");
        const minusIcon = question.querySelector(".faq-icon-minus");
        
        if (isExpanded) {
          question.setAttribute("aria-expanded", "false");
          answer.style.maxHeight = "0";
          if (plusIcon) plusIcon.classList.remove("hidden");
          if (minusIcon) minusIcon.classList.add("hidden");
          item.classList.remove("faq-expanded");
        } else {
          question.setAttribute("aria-expanded", "true");
          answer.style.maxHeight = answer.scrollHeight + "px";
          if (plusIcon) plusIcon.classList.add("hidden");
          if (minusIcon) minusIcon.classList.remove("hidden");
          item.classList.add("faq-expanded");

          // 滚动到视图
          setTimeout(() => {
            item.scrollIntoView({ behavior: "smooth", block: "nearest" });
          }, 300);
        }
      });
    });

    // 默认展开第一个FAQ
    const firstQuestion = faqItems[0]?.querySelector(".faq-question");
    const firstAnswer = faqItems[0]?.querySelector(
      ".faq-answer"
    ) as HTMLElement;
    const firstPlus = firstQuestion?.querySelector(".faq-icon-plus");
    const firstMinus = firstQuestion?.querySelector(".faq-icon-minus");

    if (firstQuestion && firstAnswer && faqItems[0]) {
      firstQuestion.setAttribute("aria-expanded", "true");
      firstAnswer.style.maxHeight = firstAnswer.scrollHeight + "px";
      if (firstPlus) firstPlus.classList.add("hidden");
      if (firstMinus) firstMinus.classList.remove("hidden");
      faqItems[0].classList.add("faq-expanded");
    }
  });
</script>

<style>
  .faq-icon {
    transition: all 0.3s ease;
  }

  .faq-answer {
    transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* 卡片进入动画 */
  @media (prefers-reduced-motion: no-preference) {
    .faq-item {
      animation: fadeInUp 0.5s ease-out backwards;
    }
    
    .faq-item[data-index="0"] { animation-delay: 0.05s; }
    .faq-item[data-index="1"] { animation-delay: 0.1s; }
    .faq-item[data-index="2"] { animation-delay: 0.15s; }
    .faq-item[data-index="3"] { animation-delay: 0.2s; }
    .faq-item[data-index="4"] { animation-delay: 0.25s; }
    .faq-item[data-index="5"] { animation-delay: 0.3s; }
    .faq-item[data-index="6"] { animation-delay: 0.35s; }
    .faq-item[data-index="7"] { animation-delay: 0.4s; }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(15px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }

  /* 展开状态的样式 */
  .faq-expanded .faq-question {
    border-color: rgb(251 146 60 / 0.5);
    background: white;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
  }

  .faq-expanded .faq-question .faq-icon {
    background: rgb(251 146 60 / 0.15);
  }

  /* 移动端优化 */
  @media (max-width: 768px) {
    .faq-question {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
      padding-top: 1rem !important;
      padding-bottom: 1rem !important;
    }

    .faq-answer > div {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
      padding-top: 1rem !important;
      padding-bottom: 1rem !important;
    }
  }
</style>
