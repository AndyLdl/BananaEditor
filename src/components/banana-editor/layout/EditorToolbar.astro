---
// EditorToolbar.astro - BananaEditoré¡¶éƒ¨å·¥å…·æ ç»„ä»¶
// æä¾›åŠŸèƒ½åˆ‡æ¢ã€è¯­è¨€åˆ‡æ¢å’Œå¯¼å‡ºé€‰é¡¹

export interface Props {
  currentMode?: "generate" | "fusion";
  currentLanguage?: string;
  showMobileMenu?: boolean;
}

const {
  currentMode = "generate",
  currentLanguage = "zh",
  showMobileMenu = true,
} = Astro.props;

// è¯­è¨€é€‰é¡¹é…ç½®
const languages = [
  { code: "zh", name: "ä¸­æ–‡", flag: "ğŸ‡¨ğŸ‡³" },
  { code: "en", name: "English", flag: "ğŸ‡ºğŸ‡¸" },
  { code: "es", name: "EspaÃ±ol", flag: "ğŸ‡ªğŸ‡¸" },
  { code: "fr", name: "FranÃ§ais", flag: "ğŸ‡«ğŸ‡·" },
];

// å¯¼å‡ºæ ¼å¼é€‰é¡¹
const exportFormats = [
  { value: "png", label: "PNG", description: "é«˜è´¨é‡é€æ˜èƒŒæ™¯" },
  { value: "jpg", label: "JPG", description: "æ ‡å‡†å›¾ç‰‡æ ¼å¼" },
  { value: "webp", label: "WebP", description: "ç°ä»£å‹ç¼©æ ¼å¼" },
  { value: "svg", label: "SVG", description: "çŸ¢é‡å›¾æ ¼å¼" },
];
---

<div class="editor-toolbar-container">
  <!-- å·¦ä¾§å“ç‰ŒåŒºåŸŸ -->
  <div class="toolbar-left">
    <div class="brand-section">
      <a href="/" class="brand-link">
        <span class="brand-icon">ğŸŒ</span>
        <h1 class="brand-title">BananaEditor</h1>
        <span class="brand-badge">AI</span>
      </a>
    </div>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="breadcrumb-nav" aria-label="é¡µé¢å¯¼èˆª">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
          <a href="/" class="breadcrumb-link">é¦–é¡µ</a>
        </li>
        <li class="breadcrumb-separator">/</li>
        <li class="breadcrumb-item current">
          <span class="breadcrumb-current">ç¼–è¾‘å™¨</span>
        </li>
      </ol>
    </nav>
  </div>

  <!-- ä¸­å¤®åŠŸèƒ½åˆ‡æ¢åŒºåŸŸ -->
  <div class="toolbar-center">
    <div class="mode-switcher" role="tablist" aria-label="ç¼–è¾‘æ¨¡å¼é€‰æ‹©">
      <button
        class={`mode-button ${currentMode === "generate" ? "active" : ""}`}
        role="tab"
        aria-selected={currentMode === "generate"}
        aria-controls="generate-panel"
        data-mode="generate"
        id="generate-tab">
        <span class="mode-icon" aria-hidden="true">âœ¨</span>
        <span class="mode-label">AIç”Ÿæˆ</span>
        <span class="mode-description">ä»æ–‡å­—ç”Ÿæˆå›¾ç‰‡</span>
      </button>

      <button
        class={`mode-button ${currentMode === "fusion" ? "active" : ""}`}
        role="tab"
        aria-selected={currentMode === "fusion"}
        aria-controls="fusion-panel"
        data-mode="fusion"
        id="fusion-tab">
        <span class="mode-icon" aria-hidden="true">ğŸ”„</span>
        <span class="mode-label">å›¾ç‰‡èåˆ</span>
        <span class="mode-description">æ™ºèƒ½èåˆä¸¤å¼ å›¾ç‰‡</span>
      </button>
    </div>
  </div>

  <!-- å³ä¾§æ“ä½œåŒºåŸŸ -->
  <div class="toolbar-right">
    <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
    <div class="language-switcher">
      <button
        class="language-button"
        aria-label="åˆ‡æ¢è¯­è¨€"
        aria-haspopup="true"
        aria-expanded="false"
        id="language-toggle">
        <span class="language-flag" aria-hidden="true">
          {
            languages.find((lang) => lang.code === currentLanguage)?.flag ||
              "ğŸŒ"
          }
        </span>
        <span class="language-name">
          {
            languages.find((lang) => lang.code === currentLanguage)?.name ||
              "ä¸­æ–‡"
          }
        </span>
        <span class="dropdown-arrow" aria-hidden="true">â–¼</span>
      </button>

      <div class="language-dropdown" id="language-dropdown" role="menu">
        {
          languages.map((lang) => (
            <button
              class={`language-option ${lang.code === currentLanguage ? "active" : ""}`}
              role="menuitem"
              data-language={lang.code}>
              <span class="option-flag" aria-hidden="true">
                {lang.flag}
              </span>
              <span class="option-name">{lang.name}</span>
              {lang.code === currentLanguage && (
                <span class="option-check" aria-hidden="true">
                  âœ“
                </span>
              )}
            </button>
          ))
        }
      </div>
    </div>

    <!-- å¯¼å‡ºæŒ‰é’® -->
    <div class="export-section">
      <button
        class="export-button"
        aria-label="å¯¼å‡ºå›¾ç‰‡"
        aria-haspopup="true"
        aria-expanded="false"
        id="export-toggle">
        <span class="export-icon" aria-hidden="true">ğŸ’¾</span>
        <span class="export-label">å¯¼å‡º</span>
        <span class="dropdown-arrow" aria-hidden="true">â–¼</span>
      </button>

      <div class="export-dropdown" id="export-dropdown" role="menu">
        <div class="export-header">
          <h3>é€‰æ‹©å¯¼å‡ºæ ¼å¼</h3>
        </div>
        {
          exportFormats.map((format) => (
            <button
              class="export-option"
              role="menuitem"
              data-format={format.value}>
              <div class="export-option-main">
                <span class="export-format">{format.label}</span>
                <span class="export-description">{format.description}</span>
              </div>
              <span class="export-arrow" aria-hidden="true">
                â†’
              </span>
            </button>
          ))
        }
        <div class="export-divider"></div>
        <button class="export-option export-settings" role="menuitem">
          <div class="export-option-main">
            <span class="export-format">é«˜çº§è®¾ç½®</span>
            <span class="export-description">è‡ªå®šä¹‰å°ºå¯¸å’Œè´¨é‡</span>
          </div>
          <span class="export-arrow" aria-hidden="true">âš™ï¸</span>
        </button>
      </div>
    </div>

    <!-- æ›´å¤šæ“ä½œ -->
    <div class="more-actions">
      <button
        class="action-button"
        aria-label="æ’¤é”€æ“ä½œ"
        title="æ’¤é”€ (Ctrl+Z)"
        id="undo-button">
        <span class="action-icon" aria-hidden="true">â†¶</span>
      </button>

      <button
        class="action-button"
        aria-label="é‡åšæ“ä½œ"
        title="é‡åš (Ctrl+Y)"
        id="redo-button">
        <span class="action-icon" aria-hidden="true">â†·</span>
      </button>

      <button
        class="action-button"
        aria-label="å¸®åŠ©"
        title="å¸®åŠ©å’Œå¿«æ·é”®"
        id="help-button">
        <span class="action-icon" aria-hidden="true">â“</span>
      </button>
    </div>

    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    {
      showMobileMenu && (
        <button
          class="mobile-menu-button"
          aria-label="æ‰“å¼€ç§»åŠ¨ç«¯èœå•"
          id="mobile-menu-toggle">
          <span class="hamburger-icon" aria-hidden="true">
            â˜°
          </span>
        </button>
      )
    }
  </div>
</div>

<style>
  /* å·¥å…·æ å®¹å™¨ */
  .editor-toolbar-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: 100%;
    padding: 0 16px;
    background: var(--banana-gradient);
    border-bottom: 2px solid var(--banana-border, #ffe55c);
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2);
    position: relative;
  }

  /* å·¦ä¾§å“ç‰ŒåŒºåŸŸ */
  .toolbar-left {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-shrink: 0;
  }

  .brand-section {
    display: flex;
    align-items: center;
  }

  .brand-link {
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s ease;
  }

  .brand-link:hover {
    transform: scale(1.02);
  }

  .brand-icon {
    font-size: 24px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }

  .brand-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--banana-dark, #2d1810);
    margin: 0;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .brand-badge {
    background: var(--banana-accent, #ff6b35);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* é¢åŒ…å±‘å¯¼èˆª */
  .breadcrumb-nav {
    display: flex;
    align-items: center;
  }

  .breadcrumb-list {
    display: flex;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 4px;
  }

  .breadcrumb-item {
    display: flex;
    align-items: center;
  }

  .breadcrumb-link {
    color: var(--banana-dark, #2d1810);
    text-decoration: none;
    font-size: 14px;
    opacity: 0.7;
    transition: opacity 0.2s ease;
  }

  .breadcrumb-link:hover {
    opacity: 1;
  }

  .breadcrumb-separator {
    color: var(--banana-dark, #2d1810);
    opacity: 0.5;
    margin: 0 4px;
  }

  .breadcrumb-current {
    color: var(--banana-dark, #2d1810);
    font-size: 14px;
    font-weight: 500;
  }

  /* ä¸­å¤®åŠŸèƒ½åˆ‡æ¢åŒºåŸŸ */
  .toolbar-center {
    flex: 1;
    display: flex;
    justify-content: center;
    max-width: 600px;
  }

  .mode-switcher {
    display: flex;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    padding: 4px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(8px);
  }

  .mode-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 12px 20px;
    border: none;
    background: transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--banana-dark, #2d1810);
    min-width: 120px;
    position: relative;
  }

  .mode-button.active {
    background: var(--banana-primary, #ffd700);
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
    transform: translateY(-1px);
  }

  .mode-button:hover:not(.active) {
    background: rgba(255, 215, 0, 0.2);
  }

  .mode-icon {
    font-size: 20px;
    margin-bottom: 2px;
  }

  .mode-label {
    font-size: 14px;
    font-weight: 600;
    line-height: 1;
  }

  .mode-description {
    font-size: 11px;
    opacity: 0.7;
    line-height: 1;
  }

  /* å³ä¾§æ“ä½œåŒºåŸŸ */
  .toolbar-right {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  /* è¯­è¨€åˆ‡æ¢å™¨ */
  .language-switcher {
    position: relative;
  }

  .language-button {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    border: none;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--banana-dark, #2d1810);
    font-size: 14px;
    font-weight: 500;
  }

  .language-button:hover {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .language-flag {
    font-size: 16px;
  }

  .dropdown-arrow {
    font-size: 10px;
    opacity: 0.6;
    transition: transform 0.2s ease;
  }

  .language-button[aria-expanded="true"] .dropdown-arrow {
    transform: rotate(180deg);
  }

  .language-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 4px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    padding: 8px;
    min-width: 160px;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.2s ease;
  }

  .language-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .language-option {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 8px 12px;
    border: none;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    text-align: left;
    font-size: 14px;
  }

  .language-option:hover {
    background: rgba(255, 215, 0, 0.1);
  }

  .language-option.active {
    background: rgba(255, 215, 0, 0.2);
    font-weight: 500;
  }

  .option-flag {
    font-size: 16px;
  }

  .option-name {
    flex: 1;
  }

  .option-check {
    color: var(--banana-accent, #ff6b35);
    font-weight: 600;
  }

  /* å¯¼å‡ºæŒ‰é’® */
  .export-section {
    position: relative;
  }

  .export-button {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    border: none;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--banana-dark, #2d1810);
    font-size: 14px;
    font-weight: 500;
  }

  .export-button:hover {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .export-icon {
    font-size: 16px;
  }

  .export-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 4px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    padding: 8px;
    min-width: 220px;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.2s ease;
  }

  .export-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .export-header {
    padding: 8px 12px;
    border-bottom: 1px solid #f0f0f0;
    margin-bottom: 4px;
  }

  .export-header h3 {
    margin: 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--banana-dark, #2d1810);
  }

  .export-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 10px 12px;
    border: none;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    text-align: left;
  }

  .export-option:hover {
    background: rgba(255, 215, 0, 0.1);
  }

  .export-option-main {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .export-format {
    font-size: 14px;
    font-weight: 500;
    color: var(--banana-dark, #2d1810);
  }

  .export-description {
    font-size: 12px;
    color: #666;
  }

  .export-arrow {
    opacity: 0.5;
    transition: opacity 0.2s ease;
  }

  .export-option:hover .export-arrow {
    opacity: 1;
  }

  .export-divider {
    height: 1px;
    background: #f0f0f0;
    margin: 4px 0;
  }

  .export-settings {
    border-top: 1px solid #f0f0f0;
    margin-top: 4px;
    padding-top: 8px;
  }

  /* æ›´å¤šæ“ä½œ */
  .more-actions {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .action-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: none;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--banana-dark, #2d1810);
  }

  .action-button:hover {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .action-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .action-icon {
    font-size: 16px;
  }

  /* ç§»åŠ¨ç«¯èœå•æŒ‰é’® */
  .mobile-menu-button {
    display: none;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--banana-dark, #2d1810);
  }

  .mobile-menu-button:hover {
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .hamburger-icon {
    font-size: 18px;
  }

  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 1024px) {
    .breadcrumb-nav {
      display: none;
    }

    .mode-button {
      min-width: 100px;
      padding: 10px 16px;
    }

    .mode-description {
      display: none;
    }
  }

  @media (max-width: 768px) {
    .toolbar-center {
      display: none;
    }

    .more-actions {
      display: none;
    }

    .mobile-menu-button {
      display: flex;
    }

    .language-switcher .language-name {
      display: none;
    }

    .export-button .export-label {
      display: none;
    }
  }

  @media (max-width: 480px) {
    .editor-toolbar-container {
      padding: 0 12px;
    }

    .brand-title {
      font-size: 16px;
    }

    .toolbar-right {
      gap: 4px;
    }

    .language-button,
    .export-button {
      padding: 6px 8px;
    }
  }

  /* é«˜å¯¹æ¯”åº¦æ¨¡å¼ */
  @media (prefers-contrast: high) {
    .mode-switcher {
      background: white;
      border: 2px solid #000;
    }

    .mode-button.active {
      background: #000;
      color: white;
    }

    .language-dropdown,
    .export-dropdown {
      border: 1px solid #000;
    }
  }

  /* å‡å°‘åŠ¨ç”» */
  @media (prefers-reduced-motion: reduce) {
    * {
      transition: none !important;
    }
  }
</style>

<script>
  // ç¼–è¾‘å™¨å·¥å…·æ äº¤äº’é€»è¾‘
  class EditorToolbar {
    private languageButton: HTMLElement | null = null;
    private languageDropdown: HTMLElement | null = null;
    private exportButton: HTMLElement | null = null;
    private exportDropdown: HTMLElement | null = null;
    private modeButtons: NodeListOf<HTMLElement> | null = null;
    private currentMode: string = "generate";

    constructor() {
      this.init();
    }

    private init(): void {
      this.languageButton = document.getElementById("language-toggle");
      this.languageDropdown = document.getElementById("language-dropdown");
      this.exportButton = document.getElementById("export-toggle");
      this.exportDropdown = document.getElementById("export-dropdown");
      this.modeButtons = document.querySelectorAll(".mode-button");

      this.setupEventListeners();
    }

    private setupEventListeners(): void {
      // æ¨¡å¼åˆ‡æ¢
      this.modeButtons?.forEach((button) => {
        button.addEventListener("click", (e) => {
          const target = e.currentTarget as HTMLElement;
          const mode = target.dataset.mode;
          if (mode) {
            this.switchMode(mode);
          }
        });
      });

      // è¯­è¨€åˆ‡æ¢å™¨
      this.languageButton?.addEventListener("click", (e) => {
        e.stopPropagation();
        this.toggleLanguageDropdown();
      });

      // è¯­è¨€é€‰é¡¹
      const languageOptions = document.querySelectorAll(".language-option");
      languageOptions.forEach((option) => {
        option.addEventListener("click", (e) => {
          const target = e.currentTarget as HTMLElement;
          const language = target.dataset.language;
          if (language) {
            this.changeLanguage(language);
          }
        });
      });

      // å¯¼å‡ºæŒ‰é’®
      this.exportButton?.addEventListener("click", (e) => {
        e.stopPropagation();
        this.toggleExportDropdown();
      });

      // å¯¼å‡ºé€‰é¡¹
      const exportOptions = document.querySelectorAll(
        ".export-option[data-format]",
      );
      exportOptions.forEach((option) => {
        option.addEventListener("click", (e) => {
          const target = e.currentTarget as HTMLElement;
          const format = target.dataset.format;
          if (format) {
            this.exportImage(format);
          }
        });
      });

      // é«˜çº§è®¾ç½®
      const settingsOption = document.querySelector(".export-settings");
      settingsOption?.addEventListener("click", () => {
        this.openExportSettings();
      });

      // æ“ä½œæŒ‰é’®
      const undoButton = document.getElementById("undo-button");
      const redoButton = document.getElementById("redo-button");
      const helpButton = document.getElementById("help-button");

      undoButton?.addEventListener("click", () => this.undo());
      redoButton?.addEventListener("click", () => this.redo());
      helpButton?.addEventListener("click", () => this.showHelp());

      // ç§»åŠ¨ç«¯èœå•
      const mobileMenuButton = document.getElementById("mobile-menu-toggle");
      mobileMenuButton?.addEventListener("click", () => {
        document.dispatchEvent(new CustomEvent("editor:toggle-mobile-menu"));
      });

      // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
      document.addEventListener("click", (e) => {
        const target = e.target as HTMLElement;
        if (!target.closest(".language-switcher")) {
          this.closeLanguageDropdown();
        }
        if (!target.closest(".export-section")) {
          this.closeExportDropdown();
        }
      });

      // é”®ç›˜å¿«æ·é”®
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case "z":
              e.preventDefault();
              this.undo();
              break;
            case "y":
              e.preventDefault();
              this.redo();
              break;
            case "s":
              e.preventDefault();
              this.exportImage("png");
              break;
          }
        }
      });
    }

    private switchMode(mode: string): void {
      this.currentMode = mode;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      this.modeButtons?.forEach((button) => {
        const isActive = button.dataset.mode === mode;
        button.classList.toggle("active", isActive);
        button.setAttribute("aria-selected", isActive.toString());
      });

      // è§¦å‘æ¨¡å¼åˆ‡æ¢äº‹ä»¶
      document.dispatchEvent(
        new CustomEvent("editor:mode-change", {
          detail: { mode },
        }),
      );

      console.log("åˆ‡æ¢åˆ°æ¨¡å¼:", mode);
    }

    private toggleLanguageDropdown(): void {
      const isOpen =
        this.languageButton?.getAttribute("aria-expanded") === "true";

      if (isOpen) {
        this.closeLanguageDropdown();
      } else {
        this.openLanguageDropdown();
      }
    }

    private openLanguageDropdown(): void {
      this.languageButton?.setAttribute("aria-expanded", "true");
      this.languageDropdown?.classList.add("show");
    }

    private closeLanguageDropdown(): void {
      this.languageButton?.setAttribute("aria-expanded", "false");
      this.languageDropdown?.classList.remove("show");
    }

    private changeLanguage(language: string): void {
      console.log("åˆ‡æ¢è¯­è¨€:", language);

      // è§¦å‘è¯­è¨€åˆ‡æ¢äº‹ä»¶
      document.dispatchEvent(
        new CustomEvent("editor:language-change", {
          detail: { language },
        }),
      );

      this.closeLanguageDropdown();

      // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„è¯­è¨€åˆ‡æ¢é€»è¾‘
      // ä¾‹å¦‚é‡æ–°åŠ è½½é¡µé¢æˆ–æ›´æ–°ç•Œé¢æ–‡æœ¬
    }

    private toggleExportDropdown(): void {
      const isOpen =
        this.exportButton?.getAttribute("aria-expanded") === "true";

      if (isOpen) {
        this.closeExportDropdown();
      } else {
        this.openExportDropdown();
      }
    }

    private openExportDropdown(): void {
      this.exportButton?.setAttribute("aria-expanded", "true");
      this.exportDropdown?.classList.add("show");
    }

    private closeExportDropdown(): void {
      this.exportButton?.setAttribute("aria-expanded", "false");
      this.exportDropdown?.classList.remove("show");
    }

    private exportImage(format: string): void {
      console.log("å¯¼å‡ºå›¾ç‰‡ï¼Œæ ¼å¼:", format);

      // è§¦å‘å¯¼å‡ºäº‹ä»¶
      document.dispatchEvent(
        new CustomEvent("editor:export-image", {
          detail: { format },
        }),
      );

      this.closeExportDropdown();

      // è¿™é‡Œå°†åœ¨åç»­ä»»åŠ¡ä¸­å®ç°å®é™…çš„å¯¼å‡ºé€»è¾‘
    }

    private openExportSettings(): void {
      console.log("æ‰“å¼€å¯¼å‡ºè®¾ç½®");

      // è§¦å‘å¯¼å‡ºè®¾ç½®äº‹ä»¶
      document.dispatchEvent(new CustomEvent("editor:export-settings"));

      this.closeExportDropdown();
    }

    private undo(): void {
      console.log("æ’¤é”€æ“ä½œ");

      // è§¦å‘æ’¤é”€äº‹ä»¶
      document.dispatchEvent(new CustomEvent("editor:undo"));
    }

    private redo(): void {
      console.log("é‡åšæ“ä½œ");

      // è§¦å‘é‡åšäº‹ä»¶
      document.dispatchEvent(new CustomEvent("editor:redo"));
    }

    private showHelp(): void {
      console.log("æ˜¾ç¤ºå¸®åŠ©");

      // è§¦å‘å¸®åŠ©äº‹ä»¶
      document.dispatchEvent(new CustomEvent("editor:show-help"));
    }

    // å…¬å…±æ–¹æ³•
    public getCurrentMode(): string {
      return this.currentMode;
    }

    public setMode(mode: string): void {
      this.switchMode(mode);
    }
  }

  // åˆå§‹åŒ–å·¥å…·æ 
  document.addEventListener("DOMContentLoaded", () => {
    const toolbar = new EditorToolbar();

    // å¯¼å‡ºåˆ°å…¨å±€ä½œç”¨åŸŸ
    (window as any).EditorToolbar = toolbar;
  });
</script>
