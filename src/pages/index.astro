---
/**
 * BananaEditor首页 - SEO优化，突出"nano banana"关键词
 * 重新设计的专业AI图片编辑器首页
 */

import Layout from "@layouts/Layout.astro";
import SEOHead from "@components/seo/SEOHead.astro";
import BananaHero from "@components/banana-editor/BananaHero.astro";
import BananaFeatures from "@components/banana-editor/BananaFeatures.astro";
import ProductFeaturesDetail from "@components/banana-editor/ProductFeaturesDetail.astro";
import BananaDemo from "@components/banana-editor/BananaDemo.astro";
import BananaUseCases from "@components/banana-editor/BananaUseCases.astro";
import BananaFAQ from "@components/banana-editor/BananaFAQ.astro";
import UserGuide from "@components/banana-editor/UserGuide.astro";
import BananaCTA from "@components/banana-editor/BananaCTA.astro";
import BananaBadges from "@components/banana-editor/BananaBadges.astro";
import { loadTranslations } from "../i18n/utils";
import { detectLanguageFromRequest } from "../utils/language-detector";

// 获取当前语言
const currentLang = detectLanguageFromRequest(Astro.request);

// 加载SEO翻译
const seoTranslations = await loadTranslations(currentLang, "seo");
const homeTranslations = await loadTranslations(currentLang, "home");

// SEO配置
const seoConfig = {
  title:
    seoTranslations.home?.title ||
    "Nano Banana - Professional AI Image Editor | BananaEditor",
  description:
    seoTranslations.home?.description ||
    "Create stunning images with nano banana AI technology. Professional image generation and fusion tools powered by advanced AI. Try BananaEditor now!",
  keywords: seoTranslations.home?.keywords || [
    "nano banana",
    "nano banana ai",
    "banana ai",
    "ai image editor",
  ],
  language: currentLang,
  ogImage: "/images/opengraph-banana-home.jpg",
  structuredData: {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    name: "Nano Banana AI Image Editor - BananaEditor",
    description:
      "Nano banana AI Image Editor delivers perfect element consistency across all scenes. Ultra-fast AI image generator powered by Google's Gemini 2.5 Flash Image. Generate 1024×1024 images in 2.3 seconds with 100% character and object consistency.",
    applicationCategory: "DesignApplication",
    operatingSystem: "Web Browser",
    url: Astro.site?.toString(),
    offers: {
      "@type": "Offer",
      price: "0",
      priceCurrency: "USD",
    },
    keywords:
      "nano banana, nano banana AI Image Editor, AI Image Editor, nano banana ai, gemini 2.5 flash image, fast ai image generator, element consistency, perfect consistency, character consistency, banana ai, image editor, ai tools",
    creator: {
      "@type": "Organization",
      name: "BananaEditor Team",
    },
    featureList: [
      "Perfect Element Consistency with Nano Banana (100%)",
      "Ultra-Fast Image Generation (2.3 seconds)",
      "Nano Banana AI Image Editor",
      "Smart Iterative Editing",
      "Smart Image Fusion",
      "Commercial-Ready Quality",
      "E-commerce Product Images",
      "Context-Aware Image Refinement",
      "Multi-language Support",
    ],
    aggregateRating: {
      "@type": "AggregateRating",
      ratingValue: "4.9",
      ratingCount: "10000",
      bestRating: "5",
      worstRating: "1",
    },
  },
};
---

<Layout title={seoConfig.title}>
  <SEOHead {...seoConfig} />

  <!-- 主要内容区域 -->
  <main class="overflow-hidden">
    <!-- Hero区域 - 突出nano banana关键词 -->
    <BananaHero />

    <!-- 功能特性展示 -->
    <BananaFeatures />

    <!-- 产品功能详细介绍 -->
    <ProductFeaturesDetail />

    <!-- 行业应用场景 -->
    <BananaUseCases />

    <!-- 常见问题FAQ -->
    <BananaFAQ />

    <!-- 最终CTA区域 -->
    <BananaCTA />

    <!-- Badge展示区域 -->
    <BananaBadges />
  </main>
</Layout>

<!-- 页面级样式 -->
<style>
  /* 确保页面流畅滚动 */
  html {
    scroll-behavior: smooth;
  }

  /* 优化页面性能 */
  main {
    contain: layout style paint;
  }

  /* 预加载关键资源 */
  @media (prefers-reduced-motion: no-preference) {
    * {
      scroll-behavior: smooth;
    }
  }
</style>

<!-- 结构化数据和额外SEO -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "BananaEditor",
    "url": "https://bananaeditor.net",
    "logo": "https://bananaeditor.net/images/logo-banana.png",
    "description": "Ultra-fast AI image generator powered by Google's Gemini 2.5 Flash Image (nano banana). Generate professional images in 2.3 seconds with perfect element consistency.",
    "sameAs": [
      "https://twitter.com/bananaeditor",
      "https://github.com/bananaeditor"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "customer service",
      "availableLanguage": ["English", "Chinese", "Spanish", "French"]
    }
  }
</script>

<!-- HowTo 结构化数据 - 如何使用Nano Banana AI Image Editor -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Use Nano Banana AI Image Editor for Perfect Element Consistency",
    "description": "Learn how to create images with nano banana AI Image Editor while maintaining perfect element consistency across different scenes.",
    "image": "https://bananaeditor.net/images/opengraph-banana-home.jpg",
    "totalTime": "PT2M",
    "tool": [
      {
        "@type": "HowToTool",
        "name": "Nano Banana AI Image Editor"
      }
    ],
    "step": [
      {
        "@type": "HowToStep",
        "position": 1,
        "name": "Access Nano Banana AI Image Editor",
        "text": "Visit BananaEditor and access the nano banana AI Image Editor. No registration required.",
        "url": "https://bananaeditor.net/editor"
      },
      {
        "@type": "HowToStep",
        "position": 2,
        "name": "Describe Your Image Idea",
        "text": "Use the chat interface to describe the image you want to create. Nano banana AI Image Editor understands natural language and will generate your image with perfect element consistency.",
        "image": "https://bananaeditor.net/images/editor-chat.jpg"
      },
      {
        "@type": "HowToStep",
        "position": 3,
        "name": "Generate Image with Consistency",
        "text": "Nano banana AI Image Editor generates 1024×1024 high-quality images in just 2.3 seconds. The AI ensures perfect consistency of characters, objects, and styles.",
        "image": "https://bananaeditor.net/images/editor-result.jpg"
      },
      {
        "@type": "HowToStep",
        "position": 4,
        "name": "Edit or Refine Images",
        "text": "Select any image from your gallery and use smart iterative editing to refine it. Nano banana AI Image Editor maintains consistency while applying your modifications.",
        "image": "https://bananaeditor.net/images/editor-gallery.jpg"
      },
      {
        "@type": "HowToStep",
        "position": 5,
        "name": "Generate Variations with Consistency",
        "text": "Create multiple scene variations (spring, summer, fall, winter) while maintaining 100% consistency of core elements using nano banana AI Image Editor's consistency technology.",
        "image": "https://bananaeditor.net/images/editor-variations.jpg"
      },
      {
        "@type": "HowToStep",
        "position": 6,
        "name": "Download Your Images",
        "text": "Download your professional-quality images generated with nano banana AI Image Editor. All images are commercial-ready and watermark-free.",
        "image": "https://bananaeditor.net/images/editor-download.jpg"
      }
    ]
  }
</script>

<!-- FAQ 结构化数据 -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is Nano Banana AI Image Editor?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano Banana AI Image Editor is powered by Google's Gemini 2.5 Flash Image model - a lightweight, ultra-fast AI image generation technology that creates high-quality 1024×1024 images in just 2.3 seconds while maintaining perfect element consistency across multiple scenes."
        }
      },
      {
        "@type": "Question",
        "name": "What makes nano banana AI Image Editor's consistency special?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor maintains 100% element consistency - unlike other AI models that struggle with character consistency, nano banana AI acts like your personal AI designer, preserving characters, objects, and styles across different scenes, poses, and environments. Generate seasonal variations with perfect visual coherence."
        }
      },
      {
        "@type": "Question",
        "name": "How does nano banana maintain element consistency in AI image editing?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor uses advanced context-aware technology to understand and preserve all visual elements. When you generate variations or edit existing images, the AI maintains consistent characters, objects, backgrounds, and styles across all outputs, ensuring perfect visual coherence."
        }
      },
      {
        "@type": "Question",
        "name": "How fast is nano banana AI Image Editor compared to other editors?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor generates images in 2.3 seconds, making it approximately 10x faster than traditional AI image generation models, while maintaining comparable or superior quality. This speed advantage makes it ideal for time-sensitive projects and high-volume content creation."
        }
      },
      {
        "@type": "Question",
        "name": "Can nano banana AI Image Editor preserve consistency across different scenes?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Nano banana AI Image Editor excels at maintaining perfect consistency across multiple scenes. You can generate the same character or object in different environments (spring, summer, fall, winter, day, night) while preserving 100% visual consistency of the core elements."
        }
      },
      {
        "@type": "Question",
        "name": "Why choose nano banana for consistent AI image generation?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor is specifically designed for perfect element consistency - the core strength that sets it apart from other AI image editors. Whether you need consistent product photos, character variations, or branded content, nano banana delivers 100% visual coherence every time."
        }
      },
      {
        "@type": "Question",
        "name": "Can I edit previously generated images with nano banana AI Image Editor?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely! Nano banana AI Image Editor features smart iterative editing. Simply select any image from your gallery and describe your desired changes in the chat interface. The AI understands context and modifies your image precisely, maintaining consistency while applying targeted refinements."
        }
      },
      {
        "@type": "Question",
        "name": "Can I use nano banana AI Image Editor images for commercial purposes?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Images generated with nano banana AI Image Editor are commercial-ready and optimized for e-commerce, advertising, social media, and marketing materials. The technology includes accurate text rendering and understands commercial visual requirements."
        }
      },
      {
        "@type": "Question",
        "name": "Is nano banana AI Image Editor suitable for professional work?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. Nano banana AI Image Editor (Gemini 2.5 Flash Image) delivers professional-grade quality with high FID scores, accurate text rendering, and exceptional visual fidelity. It's trusted by businesses for e-commerce, advertising agencies, and content creators worldwide."
        }
      },
      {
        "@type": "Question",
        "name": "How does nano banana AI Image Editor ensure element consistency?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor uses advanced context understanding to track and maintain visual elements across generations. The AI remembers characters, objects, colors, and styles, ensuring that every variation maintains 100% consistency with the original elements while allowing creative scene and pose changes."
        }
      },
      {
        "@type": "Question",
        "name": "What makes nano banana AI Image Editor different from other AI image tools?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor combines three key advantages: ultra-fast 2.3-second generation, perfect element consistency across scenes, and smart iterative editing capabilities. This unique combination makes it ideal for professional content creation where consistency and speed are crucial."
        }
      }
    ]
  }
</script>

<!-- 移动端优化和手势支持 -->
<script>
  import {
    TouchGestureHandler,
    isMobileDevice,
    debounce,
  } from "../utils/touch-gestures";

  // 注释掉 setupLanguageSwitcher() 避免与 LanguageSwitcher 组件冲突
  // import { setupLanguageSwitcher } from "../utils/language-detector";
  // setupLanguageSwitcher();

  // 初始化性能优化
  import { performanceManager } from "../utils/performance-init";
  performanceManager.initialize().catch(console.error);

  // 移动端首页优化
  class MobileHomePage {
    private touchHandler: TouchGestureHandler | null = null;
    private isMobile: boolean = false;
    private sections: NodeListOf<Element> | null = null;
    private currentSection: number = 0;

    constructor() {
      this.init();
    }

    private init(): void {
      this.isMobile = isMobileDevice();

      if (!this.isMobile) return;

      this.sections = document.querySelectorAll("main > section, main > div");
      this.setupTouchGestures();
      this.setupScrollOptimization();
      this.setupMobileNavigation();
    }

    private setupTouchGestures(): void {
      const main = document.querySelector("main");
      if (!main) return;

      this.touchHandler = new TouchGestureHandler(main);

      // 垂直滑动导航
      this.touchHandler.on("swipe", (event: any) => {
        if (Math.abs(event.deltaY) > Math.abs(event.deltaX)) {
          if (event.direction === "up" && event.velocity > 0.8) {
            this.scrollToNextSection();
          } else if (event.direction === "down" && event.velocity > 0.8) {
            this.scrollToPrevSection();
          }
        }
      });

      // 双击回到顶部
      this.touchHandler.on("tap", (event: any) => {
        const now = Date.now();
        const lastTap = (main as any).lastTapTime || 0;

        if (now - lastTap < 300) {
          this.scrollToTop();
        }

        (main as any).lastTapTime = now;
      });
    }

    private setupScrollOptimization(): void {
      // 优化滚动性能
      let ticking = false;

      const handleScroll = () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            this.updateCurrentSection();
            this.optimizeAnimations();
            ticking = false;
          });
          ticking = true;
        }
      };

      window.addEventListener("scroll", handleScroll, { passive: true });

      // 监听方向变化
      window.addEventListener("orientationchange", () => {
        setTimeout(() => {
          this.handleOrientationChange();
        }, 100);
      });
    }

    private setupMobileNavigation(): void {
      // 添加移动端导航指示器
      this.createScrollIndicator();

      // 优化CTA按钮
      this.optimizeCTAButtons();

      // 设置懒加载
      this.setupLazyLoading();
    }

    private updateCurrentSection(): void {
      if (!this.sections) return;

      const scrollY = window.scrollY;
      const windowHeight = window.innerHeight;

      this.sections.forEach((section, index) => {
        const rect = section.getBoundingClientRect();
        const sectionTop = rect.top + scrollY;

        if (
          scrollY >= sectionTop - windowHeight / 2 &&
          scrollY < sectionTop + rect.height - windowHeight / 2
        ) {
          this.currentSection = index;
        }
      });
    }

    private optimizeAnimations(): void {
      // 在移动端减少动画以提升性能
      const animatedElements = document.querySelectorAll(
        ".animate-float, .animate-pulse, .animate-bounce"
      );

      animatedElements.forEach((element) => {
        const rect = element.getBoundingClientRect();
        const isVisible = rect.top < window.innerHeight && rect.bottom > 0;

        if (isVisible) {
          element.classList.add("animate-active");
        } else {
          element.classList.remove("animate-active");
        }
      });
    }

    private scrollToNextSection(): void {
      if (!this.sections || this.currentSection >= this.sections.length - 1)
        return;

      const nextSection = this.sections[this.currentSection + 1];
      if (nextSection) {
        nextSection.scrollIntoView({ behavior: "smooth" });
        this.addHapticFeedback();
      }
    }

    private scrollToPrevSection(): void {
      if (!this.sections || this.currentSection <= 0) return;

      const prevSection = this.sections[this.currentSection - 1];
      if (prevSection) {
        prevSection.scrollIntoView({ behavior: "smooth" });
        this.addHapticFeedback();
      }
    }

    private scrollToTop(): void {
      window.scrollTo({ top: 0, behavior: "smooth" });
      this.addHapticFeedback();
    }

    private createScrollIndicator(): void {
      const indicator = document.createElement("div");
      indicator.className = "mobile-scroll-indicator";
      indicator.innerHTML = `
        <div class="scroll-dots">
          ${Array.from(this.sections || [])
            .map(
              (_, i) =>
                `<div class="scroll-dot ${i === 0 ? "active" : ""}" data-section="${i}"></div>`
            )
            .join("")}
        </div>
      `;

      // 添加样式
      const style = document.createElement("style");
      style.textContent = `
        .mobile-scroll-indicator {
          position: fixed;
          right: 16px;
          top: 50%;
          transform: translateY(-50%);
          z-index: 100;
          display: none;
        }

        .scroll-dots {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .scroll-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: rgba(255, 215, 0, 0.3);
          transition: all 0.2s ease;
          cursor: pointer;
        }

        .scroll-dot.active {
          background: #ffd700;
          transform: scale(1.2);
        }

        @media (max-width: 768px) {
          .mobile-scroll-indicator {
            display: block;
          }
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(indicator);

      // 添加点击事件
      const dots = indicator.querySelectorAll(".scroll-dot");
      dots.forEach((dot, index) => {
        dot.addEventListener("click", () => {
          if (this.sections && this.sections[index]) {
            this.sections[index].scrollIntoView({ behavior: "smooth" });
            this.updateScrollIndicator(index);
          }
        });
      });
    }

    private updateScrollIndicator(activeIndex: number): void {
      const dots = document.querySelectorAll(".scroll-dot");
      dots.forEach((dot, index) => {
        dot.classList.toggle("active", index === activeIndex);
      });
    }

    private optimizeCTAButtons(): void {
      const ctaButtons = document.querySelectorAll('a[href="/editor"]');

      ctaButtons.forEach((button) => {
        const btn = button as HTMLElement;
        btn.classList.add("touch-friendly");

        // 添加触摸反馈
        btn.addEventListener("touchstart", () => {
          btn.style.transform = "scale(0.98)";
        });

        btn.addEventListener("touchend", () => {
          btn.style.transform = "";
        });
      });
    }

    private setupLazyLoading(): void {
      // 懒加载图片和动画
      const lazyElements = document.querySelectorAll('img, [class*="animate"]');

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const element = entry.target;

              // 加载图片
              if (element.tagName === "IMG") {
                const img = element as HTMLImageElement;
                if (img.dataset.src) {
                  img.src = img.dataset.src;
                  img.removeAttribute("data-src");
                }
              }

              // 启用动画
              if (element.className.includes("animate")) {
                element.classList.add("animate-active");
              }

              observer.unobserve(element);
            }
          });
        },
        {
          rootMargin: "50px",
        }
      );

      lazyElements.forEach((element) => {
        observer.observe(element);
      });
    }

    private handleOrientationChange(): void {
      // 重新计算布局
      this.updateCurrentSection();

      // 更新滚动指示器
      this.updateScrollIndicator(this.currentSection);
    }

    private addHapticFeedback(): void {
      if ("vibrate" in navigator) {
        navigator.vibrate(30);
      }
    }

    public destroy(): void {
      if (this.touchHandler) {
        this.touchHandler.destroy();
      }
    }
  }

  // 初始化移动端首页
  document.addEventListener("DOMContentLoaded", () => {
    new MobileHomePage();
  });
</script>
