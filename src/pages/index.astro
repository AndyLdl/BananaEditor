---
/**
 * Z-Image Studio首页 - SEO优化，突出"Z-Image"关键词
 * 重新设计的专业AI图片编辑器首页
 */

import Layout from "@layouts/Layout.astro";
import SEOHead from "@components/seo/SEOHead.astro";
import BananaHero from "@components/banana-editor/BananaHero.astro";
import BananaGallery from "@components/banana-editor/BananaGallery.astro";
import BananaFeatures from "@components/banana-editor/BananaFeatures.astro";
import ProductFeaturesDetail from "@components/banana-editor/ProductFeaturesDetail.astro";
import BananaDemo from "@components/banana-editor/BananaDemo.astro";
import BananaUseCases from "@components/banana-editor/BananaUseCases.astro";
import BananaFAQ from "@components/banana-editor/BananaFAQ.astro";
import UserGuide from "@components/banana-editor/UserGuide.astro";
import BananaCTA from "@components/banana-editor/BananaCTA.astro";
import BananaBadges from "@components/banana-editor/BananaBadges.astro";
import { loadTranslations } from "../i18n/utils";
import { detectLanguageFromRequest } from "../utils/language-detector";

// 获取当前语言
const currentLang = detectLanguageFromRequest(Astro.request);

// 加载SEO翻译
const seoTranslations = await loadTranslations(currentLang, "seo");
const homeTranslations = await loadTranslations(currentLang, "home");

// SEO配置
const seoConfig = {
  title:
    seoTranslations.home?.title ||
    "Z-Image Studio - Advanced AI Image Generation Platform",
  description:
    seoTranslations.home?.description ||
    "Experience the power of Z-Image, a 6B-parameter AI image generation foundation model with single-stream diffusion transformer. Ultra-fast inference with Z-Image-Turbo variant.",
  keywords: seoTranslations.home?.keywords || [
    "Z-Image",
    "Z-Image-Turbo",
    "AI image generation",
    "diffusion transformer",
    "single-stream",
    "6B parameters",
    "ultra-fast inference",
    "bilingual text rendering",
  ],
  language: currentLang,
  ogImage: "/images/hero-example-original.png",
  structuredData: {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    name: "Z-Image - Advanced AI Image Generation Foundation Model",
    description:
      "Z-Image is a powerful 6B-parameter AI image generation foundation model with single-stream diffusion transformer technology. Features ultra-fast Z-Image-Turbo variant with sub-second inference and excellent bilingual text rendering.",
    applicationCategory: "DesignApplication",
    operatingSystem: "Web Browser",
    url: Astro.site?.toString(),
    offers: {
      "@type": "Offer",
      price: "0",
      priceCurrency: "USD",
    },
    keywords:
      "Z-Image, Z-Image-Turbo, AI image generation, diffusion transformer, single-stream, 6B parameters, ultra-fast inference, bilingual text rendering, instruction following, image editing",
    creator: {
      "@type": "Organization",
      name: "Tongyi-MAI Team",
    },
    featureList: [
      "6B Parameter Foundation Model",
      "Single-Stream Diffusion Transformer",
      "Z-Image-Turbo (Sub-second Inference)",
      "Bilingual Text Rendering (English & Chinese)",
      "Strong Instruction Following",
      "High-Resolution Generation (1024x1024)",
      "Multiple Model Variants",
      "Open-Source & Commercial Ready",
      "State-of-the-Art Performance",
    ],
    aggregateRating: {
      "@type": "AggregateRating",
      ratingValue: "4.9",
      ratingCount: "10000",
      bestRating: "5",
      worstRating: "1",
    },
  },
};
---

<Layout title={seoConfig.title}>
  <SEOHead {...seoConfig} />

  <!-- 主要内容区域 -->
  <main class="overflow-hidden">
    <!-- Hero区域 - 突出nano banana关键词 -->
    <BananaHero />

    <!-- Gallery区域 -->
    <BananaGallery />

    <!-- 功能特性展示 -->
    <BananaFeatures />

    <!-- 产品功能详细介绍 -->
    <ProductFeaturesDetail />

    <!-- 行业应用场景 -->
    <BananaUseCases />

    <!-- 常见问题FAQ -->
    <BananaFAQ />

    <!-- 最终CTA区域 -->
    <BananaCTA />

    <!-- Badge展示区域 -->
    <!-- <BananaBadges /> -->
  </main>
</Layout>

<!-- 页面级样式 -->
<style>
  /* 确保页面流畅滚动 */
  html {
    scroll-behavior: smooth;
  }

  /* 优化页面性能 */
  main {
    contain: layout style paint;
  }

  /* 预加载关键资源 */
  @media (prefers-reduced-motion: no-preference) {
    * {
      scroll-behavior: smooth;
    }
  }
</style>

<!-- 结构化数据和额外SEO -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Tongyi-MAI",
    "url": "https://github.com/Tongyi-MAI/Z-Image",
    "logo": "https://github.com/Tongyi-MAI.png",
    "description": "Advanced AI image generation foundation model with 6B parameters and single-stream diffusion transformer technology. Features Z-Image-Turbo for ultra-fast inference.",
    "sameAs": [
      "https://github.com/Tongyi-MAI/Z-Image",
      "https://huggingface.co/Tongyi-MAI"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "technical support",
      "availableLanguage": ["English", "Chinese"]
    }
  }
</script>

<!-- HowTo 结构化数据 - 如何使用Z-Image AI模型 -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Use Z-Image for Advanced AI Image Generation",
    "description": "Learn how to use Z-Image, a 6B-parameter AI image generation foundation model with single-stream diffusion transformer technology.",
    "image": "https://github.com/Tongyi-MAI/Z-Image/raw/main/assets/architecture.png",
    "totalTime": "PT5M",
    "tool": [
      {
        "@type": "HowToTool",
        "name": "Z-Image AI Model"
      }
    ],
    "step": [
      {
        "@type": "HowToStep",
        "position": 1,
        "name": "Install Z-Image",
        "text": "Clone the Z-Image repository and install dependencies. Choose between PyTorch native or Diffusers integration.",
        "url": "https://github.com/Tongyi-MAI/Z-Image"
      },
      {
        "@type": "HowToStep",
        "position": 2,
        "name": "Choose Model Variant",
        "text": "Select the appropriate Z-Image variant: Z-Image-Turbo for fastest inference (8 NFEs), Z-Image-Base for general use, or Z-Image-Edit for specialized editing tasks.",
        "image": "https://github.com/Tongyi-MAI/Z-Image/raw/main/assets/model-comparison.png"
      },
      {
        "@type": "HowToStep",
        "position": 3,
        "name": "Prepare Your Prompt",
        "text": "Craft your image generation prompt. Z-Image supports both English and Chinese text with excellent instruction following capabilities.",
        "image": "https://github.com/Tongyi-MAI/Z-Image/raw/main/assets/examples/prompt-example.png"
      },
      {
        "@type": "HowToStep",
        "position": 4,
        "name": "Generate Images",
        "text": "Run inference with your chosen parameters. Z-Image-Turbo can generate high-quality 1024×1024 images in sub-second time.",
        "image": "https://github.com/Tongyi-MAI/Z-Image/raw/main/assets/examples/generation-example.png"
      },
      {
        "@type": "HowToStep",
        "position": 5,
        "name": "Fine-tune and Customize",
        "text": "Use Z-Image-Base as a foundation for fine-tuning on custom datasets or leverage community models for specialized applications.",
        "image": "https://github.com/Tongyi-MAI/Z-Image/raw/main/assets/examples/fine-tuning.png"
      },
      {
        "@type": "HowToStep",
        "position": 6,
        "name": "Deploy in Production",
        "text": "Deploy Z-Image models on various platforms including cloud services, local infrastructure, or edge devices for production use.",
        "image": "https://github.com/Tongyi-MAI/Z-Image/raw/main/assets/deployment-options.png"
      }
    ]
  }
</script>

<!-- FAQ 结构化数据 -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is Z-Image?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Z-Image is an advanced AI image generation foundation model with 6B parameters, featuring revolutionary single-stream diffusion transformer technology. It offers multiple variants including Z-Image-Turbo for ultra-fast inference and Z-Image-Edit for specialized image editing tasks."
        }
      },
      {
        "@type": "Question",
        "name": "What makes Z-Image special?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Z-Image features single-stream diffusion transformer architecture, achieving state-of-the-art performance on major leaderboards. The Z-Image-Turbo variant delivers sub-second inference with only 8 NFEs, while maintaining excellent instruction following and bilingual text rendering capabilities."
        }
      },
      {
        "@type": "Question",
        "name": "How does nano banana maintain element consistency in AI image editing?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor uses advanced context-aware technology to understand and preserve all visual elements. When you generate variations or edit existing images, the AI maintains consistent characters, objects, backgrounds, and styles across all outputs, ensuring perfect visual coherence."
        }
      },
      {
        "@type": "Question",
        "name": "How fast is Z-Image compared to other models?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Z-Image-Turbo achieves sub-second inference latency with only 8 function evaluations (NFEs), making it significantly faster than traditional diffusion models while maintaining high quality. This speed advantage enables real-time applications and rapid iteration."
        }
      },
      {
        "@type": "Question",
        "name": "Can nano banana AI Image Editor preserve consistency across different scenes?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Nano banana AI Image Editor excels at maintaining perfect consistency across multiple scenes. You can generate the same character or object in different environments (spring, summer, fall, winter, day, night) while preserving 100% visual consistency of the core elements."
        }
      },
      {
        "@type": "Question",
        "name": "Why choose nano banana for consistent AI image generation?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor is specifically designed for perfect element consistency - the core strength that sets it apart from other AI image editors. Whether you need consistent product photos, character variations, or branded content, nano banana delivers 100% visual coherence every time."
        }
      },
      {
        "@type": "Question",
        "name": "Can I edit previously generated images with nano banana AI Image Editor?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely! Nano banana AI Image Editor features smart iterative editing. Simply select any image from your gallery and describe your desired changes in the chat interface. The AI understands context and modifies your image precisely, maintaining consistency while applying targeted refinements."
        }
      },
      {
        "@type": "Question",
        "name": "Can I use nano banana AI Image Editor images for commercial purposes?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Images generated with nano banana AI Image Editor are commercial-ready and optimized for e-commerce, advertising, social media, and marketing materials. The technology includes accurate text rendering and understands commercial visual requirements."
        }
      },
      {
        "@type": "Question",
        "name": "Is nano banana AI Image Editor suitable for professional work?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. Nano banana AI Image Editor (Gemini 2.5 Flash Image) delivers professional-grade quality with high FID scores, accurate text rendering, and exceptional visual fidelity. It's trusted by businesses for e-commerce, advertising agencies, and content creators worldwide."
        }
      },
      {
        "@type": "Question",
        "name": "How does nano banana AI Image Editor ensure element consistency?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Nano banana AI Image Editor uses advanced context understanding to track and maintain visual elements across generations. The AI remembers characters, objects, colors, and styles, ensuring that every variation maintains 100% consistency with the original elements while allowing creative scene and pose changes."
        }
      },
      {
        "@type": "Question",
        "name": "What makes Z-Image different from other AI image models?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Z-Image combines revolutionary single-stream diffusion transformer architecture with outstanding performance on leaderboards, achieving 8th place overall and #1 among open-source models. Its multiple variants cater to different needs while maintaining excellent quality and instruction following."
        }
      }
    ]
  }
</script>

<!-- 移动端优化和手势支持 -->
<script>
  import {
    TouchGestureHandler,
    isMobileDevice,
    debounce,
  } from "../utils/touch-gestures";

  // 注释掉 setupLanguageSwitcher() 避免与 LanguageSwitcher 组件冲突
  // import { setupLanguageSwitcher } from "../utils/language-detector";
  // setupLanguageSwitcher();

  // 初始化性能优化
  import { performanceManager } from "../utils/performance-init";
  performanceManager.initialize().catch(console.error);

  // 移动端首页优化
  class MobileHomePage {
    private touchHandler: TouchGestureHandler | null = null;
    private isMobile: boolean = false;
    private sections: NodeListOf<Element> | null = null;
    private currentSection: number = 0;

    constructor() {
      this.init();
    }

    private init(): void {
      this.isMobile = isMobileDevice();

      if (!this.isMobile) return;

      this.sections = document.querySelectorAll("main > section, main > div");
      this.setupTouchGestures();
      this.setupScrollOptimization();
      this.setupMobileNavigation();
    }

    private setupTouchGestures(): void {
      const main = document.querySelector("main");
      if (!main) return;

      this.touchHandler = new TouchGestureHandler(main);

      // 垂直滑动导航
      this.touchHandler.on("swipe", (event: any) => {
        if (Math.abs(event.deltaY) > Math.abs(event.deltaX)) {
          if (event.direction === "up" && event.velocity > 0.8) {
            this.scrollToNextSection();
          } else if (event.direction === "down" && event.velocity > 0.8) {
            this.scrollToPrevSection();
          }
        }
      });

      // 双击回到顶部
      this.touchHandler.on("tap", (event: any) => {
        const now = Date.now();
        const lastTap = (main as any).lastTapTime || 0;

        if (now - lastTap < 300) {
          this.scrollToTop();
        }

        (main as any).lastTapTime = now;
      });
    }

    private setupScrollOptimization(): void {
      // 优化滚动性能
      let ticking = false;

      const handleScroll = () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            this.updateCurrentSection();
            this.optimizeAnimations();
            ticking = false;
          });
          ticking = true;
        }
      };

      window.addEventListener("scroll", handleScroll, { passive: true });

      // 监听方向变化
      window.addEventListener("orientationchange", () => {
        setTimeout(() => {
          this.handleOrientationChange();
        }, 100);
      });
    }

    private setupMobileNavigation(): void {
      // 添加移动端导航指示器
      this.createScrollIndicator();

      // 优化CTA按钮
      this.optimizeCTAButtons();

      // 设置懒加载
      this.setupLazyLoading();
    }

    private updateCurrentSection(): void {
      if (!this.sections) return;

      const scrollY = window.scrollY;
      const windowHeight = window.innerHeight;

      this.sections.forEach((section, index) => {
        const rect = section.getBoundingClientRect();
        const sectionTop = rect.top + scrollY;

        if (
          scrollY >= sectionTop - windowHeight / 2 &&
          scrollY < sectionTop + rect.height - windowHeight / 2
        ) {
          this.currentSection = index;
        }
      });
    }

    private optimizeAnimations(): void {
      // 在移动端减少动画以提升性能
      const animatedElements = document.querySelectorAll(
        ".animate-float, .animate-pulse, .animate-bounce"
      );

      animatedElements.forEach((element) => {
        const rect = element.getBoundingClientRect();
        const isVisible = rect.top < window.innerHeight && rect.bottom > 0;

        if (isVisible) {
          element.classList.add("animate-active");
        } else {
          element.classList.remove("animate-active");
        }
      });
    }

    private scrollToNextSection(): void {
      if (!this.sections || this.currentSection >= this.sections.length - 1)
        return;

      const nextSection = this.sections[this.currentSection + 1];
      if (nextSection) {
        nextSection.scrollIntoView({ behavior: "smooth" });
        this.addHapticFeedback();
      }
    }

    private scrollToPrevSection(): void {
      if (!this.sections || this.currentSection <= 0) return;

      const prevSection = this.sections[this.currentSection - 1];
      if (prevSection) {
        prevSection.scrollIntoView({ behavior: "smooth" });
        this.addHapticFeedback();
      }
    }

    private scrollToTop(): void {
      window.scrollTo({ top: 0, behavior: "smooth" });
      this.addHapticFeedback();
    }

    private createScrollIndicator(): void {
      const indicator = document.createElement("div");
      indicator.className = "mobile-scroll-indicator";
      indicator.innerHTML = `
        <div class="scroll-dots">
          ${Array.from(this.sections || [])
            .map(
              (_, i) =>
                `<div class="scroll-dot ${i === 0 ? "active" : ""}" data-section="${i}"></div>`
            )
            .join("")}
        </div>
      `;

      // 添加样式
      const style = document.createElement("style");
      style.textContent = `
        .mobile-scroll-indicator {
          position: fixed;
          right: 16px;
          top: 50%;
          transform: translateY(-50%);
          z-index: 100;
          display: none;
        }

        .scroll-dots {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .scroll-dot {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: rgba(255, 215, 0, 0.3);
          transition: all 0.2s ease;
          cursor: pointer;
        }

        .scroll-dot.active {
          background: #ffd700;
          transform: scale(1.2);
        }

        @media (max-width: 768px) {
          .mobile-scroll-indicator {
            display: block;
          }
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(indicator);

      // 添加点击事件
      const dots = indicator.querySelectorAll(".scroll-dot");
      dots.forEach((dot, index) => {
        dot.addEventListener("click", () => {
          if (this.sections && this.sections[index]) {
            this.sections[index].scrollIntoView({ behavior: "smooth" });
            this.updateScrollIndicator(index);
          }
        });
      });
    }

    private updateScrollIndicator(activeIndex: number): void {
      const dots = document.querySelectorAll(".scroll-dot");
      dots.forEach((dot, index) => {
        dot.classList.toggle("active", index === activeIndex);
      });
    }

    private optimizeCTAButtons(): void {
      const ctaButtons = document.querySelectorAll(
        'a[href="/#hero"], a[href="#hero"]'
      );

      ctaButtons.forEach((button) => {
        const btn = button as HTMLElement;
        btn.classList.add("touch-friendly");

        // 添加触摸反馈
        btn.addEventListener("touchstart", () => {
          btn.style.transform = "scale(0.98)";
        });

        btn.addEventListener("touchend", () => {
          btn.style.transform = "";
        });
      });
    }

    private setupLazyLoading(): void {
      // 懒加载图片和动画
      const lazyElements = document.querySelectorAll('img, [class*="animate"]');

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const element = entry.target;

              // 加载图片
              if (element.tagName === "IMG") {
                const img = element as HTMLImageElement;
                if (img.dataset.src) {
                  img.src = img.dataset.src;
                  img.removeAttribute("data-src");
                }
              }

              // 启用动画
              if (element.className.includes("animate")) {
                element.classList.add("animate-active");
              }

              observer.unobserve(element);
            }
          });
        },
        {
          rootMargin: "50px",
        }
      );

      lazyElements.forEach((element) => {
        observer.observe(element);
      });
    }

    private handleOrientationChange(): void {
      // 重新计算布局
      this.updateCurrentSection();

      // 更新滚动指示器
      this.updateScrollIndicator(this.currentSection);
    }

    private addHapticFeedback(): void {
      if ("vibrate" in navigator) {
        navigator.vibrate(30);
      }
    }

    public destroy(): void {
      if (this.touchHandler) {
        this.touchHandler.destroy();
      }
    }
  }

  // 初始化移动端首页
  document.addEventListener("DOMContentLoaded", () => {
    new MobileHomePage();
  });
</script>
